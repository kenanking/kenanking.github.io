<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>DeepLabv2：基于空洞卷积与 ASPP 的语义图像分割 | Yan Tang</title><meta name=keywords content="图像分割,DeepLabv1,DeepLabv2"><meta name=description content="DeepLabv2 通过空洞卷积和上采样滤波器进行密集特征提取，将在图像分类上训练的网络重新用于语义分割任务。文中进一步提出ASPP以在多个尺度上编码对象以及图像上下文。为了产生语义准确的预测和精细的物体边界分割图，文中还结合了深度卷积神经网络和全连接条件随机场的思想。"><meta name=author content="Yan Tang"><link rel=canonical href=https://kenanking.github.io/posts/2023/07-deeplabv2/><link crossorigin=anonymous href=/assets/css/stylesheet.7d6c2be2ce8d304b9de78bb980a8328b9454f69f9c59241fe5c9b37e708b283c.css integrity="sha256-fWwr4s6NMEud54u5gKgyi5RU9p+cWSQf5cmzfnCLKDw=" rel="preload stylesheet" as=style><link rel=icon href=https://kenanking.github.io/assets/images/favicon-16x16.ico><link rel=icon type=image/png sizes=16x16 href=https://kenanking.github.io/assets/images/favicon-16x16.ico><link rel=icon type=image/png sizes=32x32 href=https://kenanking.github.io/assets/images/favicon-32x32.ico><link rel=apple-touch-icon href=https://kenanking.github.io/assets/images/apple-touch-icon.png><link rel=mask-icon href=https://kenanking.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://kenanking.github.io/posts/2023/07-deeplabv2/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><link href=https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/katex.min.css rel=stylesheet integrity=sha384-5TcZemv2l/9On385z///+d7MSYlvIEw9FuZTIdZ14vJLqWphw7e7ZPuOiCHJcFCP crossorigin=anonymous><meta property="og:url" content="https://kenanking.github.io/posts/2023/07-deeplabv2/"><meta property="og:site_name" content="Yan Tang"><meta property="og:title" content="DeepLabv2：基于空洞卷积与 ASPP 的语义图像分割"><meta property="og:description" content="DeepLabv2 通过空洞卷积和上采样滤波器进行密集特征提取，将在图像分类上训练的网络重新用于语义分割任务。文中进一步提出ASPP以在多个尺度上编码对象以及图像上下文。为了产生语义准确的预测和精细的物体边界分割图，文中还结合了深度卷积神经网络和全连接条件随机场的思想。"><meta property="og:locale" content="zh-cn"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-07-04T00:00:00+00:00"><meta property="article:modified_time" content="2023-07-04T00:00:00+00:00"><meta property="article:tag" content="图像分割"><meta property="article:tag" content="DeepLabv1"><meta property="article:tag" content="DeepLabv2"><meta name=twitter:card content="summary"><meta name=twitter:title content="DeepLabv2：基于空洞卷积与 ASPP 的语义图像分割"><meta name=twitter:description content="DeepLabv2 通过空洞卷积和上采样滤波器进行密集特征提取，将在图像分类上训练的网络重新用于语义分割任务。文中进一步提出ASPP以在多个尺度上编码对象以及图像上下文。为了产生语义准确的预测和精细的物体边界分割图，文中还结合了深度卷积神经网络和全连接条件随机场的思想。"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://kenanking.github.io/posts/"},{"@type":"ListItem","position":2,"name":"DeepLabv2：基于空洞卷积与 ASPP 的语义图像分割","item":"https://kenanking.github.io/posts/2023/07-deeplabv2/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"DeepLabv2：基于空洞卷积与 ASPP 的语义图像分割","name":"DeepLabv2：基于空洞卷积与 ASPP 的语义图像分割","description":"DeepLabv2 通过空洞卷积和上采样滤波器进行密集特征提取，将在图像分类上训练的网络重新用于语义分割任务。文中进一步提出ASPP以在多个尺度上编码对象以及图像上下文。为了产生语义准确的预测和精细的物体边界分割图，文中还结合了深度卷积神经网络和全连接条件随机场的思想。","keywords":["图像分割","DeepLabv1","DeepLabv2"],"articleBody":"DeepLabv2 通过空洞卷积和上采样滤波器进行密集特征提取，将在图像分类上训练的网络重新用于语义分割任务。文中进一步提出 ASPP 以在多个尺度上编码对象以及图像上下文。为了产生语义准确的预测和精细的物体边界分割图，文中还结合了深度卷积神经网络和全连接条件随机场的思想。\n深度卷积神经网络应用于语义分割的三个挑战：\n特征分辨率降低：DCNN 设计之初用于图像分类问题，使用多层的 Max-Pool 和全连接层，在处理图像时，特征空间分辨率降低。 多尺度目标：图像中的分割对象以多种尺度存在。 DCNN 的不变性导致的定位误差：深度卷积神经网络的不变性可能会导致定位精度降低。 为了解决这些问题，DeepLabv2 使用了下面的方法：\n去除 Max-Pool 层并使用空洞卷积（atrous convolution） 空洞空间金字塔池化（atrous spatial pyramid pooling，ASPP） 深度卷积网络与概率图模型结合，使用全连接条件随机场（fully connected CRFs）进行后处理 DeepLabv2 模型示意图\n1. 空洞卷积（atrous/dilated convolution） 在一维情况下，空洞卷积定义为：\ny[i]=∑k=1Kx[i+r⋅k]w[k] y[i]=\\sum_{k=1}^K x[i+r \\cdot k] w[k] y[i]=k=1∑K​x[i+r⋅k]w[k]其中：x[i]x[i]x[i] 为输入信号，y[i]y[i]y[i] 为输出信号，w[k]w[k]w[k] 是一个长度为 KKK 的滤波器。rrr 是扩张率，当 r=1r=1r=1 时退化为标准卷积。\n在语义分割模型中，通过在卷积核的每个像素之间插入“空洞”（零）来构建二维的空洞卷积。\n空洞卷积 扩张率为3的空洞卷积 普通卷积 空洞卷积、扩张率为3的空洞卷积和普通卷积的对比\n空洞卷积在不增加参数量和计算量的情况下，有效地增加了滤波器的 感受野（field-of-view）。对于语义分割（或目标检测）来说，增加感受野可以更好地捕捉图像的 上下文信息（context），从而提升多尺度目标的提取能力。\n另外，在 DCNN 中通过 Max-Pool（或带 stride 的卷积）的方式提升感受野，这种方式会降低特征图的分辨率，导致空间信息的丢失。空洞卷积允许网络在不降低分辨率的情况下增加感受野，这在图像分割中非常重要。\n从下图可以看到引入空洞卷积后，对 VGG16 网络的感受野的影响（DeepLab_LargeFOV）：\nVGG16 网络各层感受野增长对比图：蓝色圆点表示原始模型，橙色方框表示 DeepLab-LargeFOV 模型\n存在问题 理论上，空洞卷积天生存在 格网效应（Gridding Effect）。在下图中，连续三次使用扩张率为 222（r=2r=2r=2）的空洞卷积时，对于中心像素 ppp 只能以棋盘的方式获取上下文信息，丢失了 75%75\\%75% 的有效信息 1。在参数选择上，过小的扩张率会获取不到足够的上下文信息，而过大的扩张率会导致更严重的格网效应。\n空洞卷积的格网效应\n因此提出了 混合空洞卷积（hybrid dilated convolution，HDC） 的方式，连续三个空洞卷积的扩张率分别设置为 r=[1,2,5]r=[1,2,5]r=[1,2,5] 来避免格网效应。\n混合空洞卷积（HDC）\n当输入特征图具有高频内容时，空洞卷积可能在输出中产生格网效应，如下图中的第三列 2。我的理解：空洞卷积会把距离较远的高频激活值带到当前的位置（同样也有可能把低频信息带到当前位置），其实可能会导致当前位置的信息与局部的特征不匹配。（高频值对参数影响大，高频的激活值会不利于网络训练）\n高频信息在格网效应后的输出\n去除 Max-Pool：Max-Pool 容易引入高频的激活值，使用卷积替换 Max-Pool 可以缓解网格化。（有效性难说！） 在网络最后添加扩张率逐渐减小的卷积层：类似 HDC。 在后面添加的卷积层中去除残差连接：防止之前层的高频信号往后传播。 空洞卷积导致的格网效应\n2. Atrous Spatial Pyramid Pooling（ASPP） 文中尝试了两种不同的方式来处理多尺度问题：\n将 原始图像缩放为三个不同的尺寸，输入到权重共享的DCNN中得到特征图，将特征图使用双线性插值到原图分辨率，通过选取每个尺度下最大的响应值来进行特征融合。\n受 SPP 3 启发，对单一尺度提取的卷积特征进行重新采样获取多尺度特征。文中使用空洞卷积实现了SPP的变体ASPP，通过不同的采样率，ASPP能够探测具有不同感受野的特征，从而在多个尺度上捕获分割对象以及图像的上下文信息。\nSpatial Pyramid Pooling\nSPP 将图像分成多个子区域，在每个区域内进行池化操作，最后将所有区域的池化结果拼接成一个固定长度 (16+4+1)×256(16+4+1) \\times 256(16+4+1)×256 的向量。\nAtrous Spatial Pyramid Pooling\n下面是在加入了 ASPP 后相比原 DeepLabv1 的改进。\nDeepLab-ASPP\n3. Fully Connected CRFs 条件随机场（CRFs）是一种概率图模型，它可以用来 建模输出变量之间的依赖关系，被用于语义分割和单目深度估计任务（NeW CRFs 4，CVPR 2022）中。可以证明，CRFs 在基于当前和相邻节点信息的情况下，能有效纠正错误的预测结果。CRFs 倾向于将空间上和颜色上相近的点归于相同的类别标签，起到平滑预测结果、去除噪声的作用。\n在语义图像分割中，输出变量就是每个像素的类别标签，而依赖关系就是像素之间的相似性和一致性。CRFs 可以用来对DCNNs的预测结果进行优化，使得分割结果更加平滑和精确。\n在图模型中，全连接的 CRFs 的能量函数定义为：\nE(x)=∑iθi(xi)+∑ijθij(xi,xj) E(\\boldsymbol{x})=\\sum_i \\theta_i\\left(x_i\\right)+\\sum_{i j} \\theta_{i j}\\left(x_i, x_j\\right) E(x)=i∑​θi​(xi​)+ij∑​θij​(xi​,xj​)其中，x\\boldsymbol{x}x 为类别标签，θi=−log⁡P(xi)\\theta_i=-\\log P(x_i)θi​=−logP(xi​) 为一元势函数（unary potential），P(xi)P(x_i)P(xi​) 是 DCNN 预测的当前类别标签的置信度。θij\\theta_{i j}θij​ 为二元势函数（pairwise potential），表示对于所有的像素对 iii、jjj，当它们的位置 ppp 和像素值 III 越接近时，越倾向于归为同一类。二元势函数的形式如下：\nθij(xi,xj)=μ(xi,xj)[w1exp⁡(−∥pi−pj∥22σα2−∥Ii−Ij∥22σβ2)+w2exp⁡(−∥pi−pj∥22σγ2)] \\begin{gathered} \\theta_{i j}\\left(x_i, x_j\\right)=\\mu\\left(x_i, x_j\\right)\\left[w_1 \\exp \\left(-\\frac{\\left\\|p_i-p_j\\right\\|^2}{2 \\sigma_\\alpha^2}-\\frac{\\left\\|I_i-I_j\\right\\|^2}{2 \\sigma_\\beta^2}\\right)\\right. \\\\ \\left.+w_2 \\exp \\left(-\\frac{\\left\\|p_i-p_j\\right\\|^2}{2 \\sigma_\\gamma^2}\\right)\\right] \\end{gathered} θij​(xi​,xj​)=μ(xi​,xj​)[w1​exp(−2σα2​∥pi​−pj​∥2​−2σβ2​∥Ii​−Ij​∥2​)+w2​exp(−2σγ2​∥pi​−pj​∥2​)]​其中，当 xi≠xjx_i \\neq x_jxi​=xj​ 时，μ(xi,xj)=1\\mu\\left(x_i, x_j\\right)=1μ(xi​,xj​)=1，否则为 000。\n一元势函数中的信息由神经网络输出的概率图提供，二元势函数中的信息由原图提供。当能量函数 E(x)E(\\boldsymbol{x})E(x) 越小时，预测的类别标签 x\\boldsymbol{x}x 就越准确，通过迭代最小化能量函数，得到最终的后处理结果。该能量函数可以通过 近似推断 的方式进一步加速 5。\n在下图中可以看到，使用 CRFs 后，在对象的边界处可以得到更明确的分类效果。至于为什么要在全图范围计算 CRFs，文中提到是因为 DCNN 给出的结果非常平滑（下图第一行第二列），使用 短程（short-range）的 CRF 会进一步平滑结果。\nCRF 对分割结果的精化\n全连接的 CRFs 针对全图计算能量函数，当图像分辨率提升时，计算量会急剧增加。因此，在 NeW CRFs（CVPR 2022）工作中，划分了多个窗口计算 CRFs，并引入了 Swin Transformer 中的滑窗方式，在不同窗口中进行交互。\n全连接的 CRFs 和分窗口的 CRFs\nWang, P., et al. “Understanding Convolution for Semantic Segmentation.” IEEE WACV, 2018. ↩︎\nYu, F., Koltun, V., Funkhouser, T. “Dilated Residual Networks.” CVPR, 2017. ↩︎\nHe, K., et al. “Spatial Pyramid Pooling in Deep Convolutional Networks for Visual Recognition.” IEEE TPAMI 37(9), 2015. ↩︎\nYuan, W., et al. “Neural Window Fully-Connected CRFs for Monocular Depth Estimation.” CVPR, 2022. ↩︎\nKrähenbühl, P., Koltun, V. “Efficient Inference in Fully Connected CRFs with Gaussian Edge Potentials.” NIPS, 2011. ↩︎\n","wordCount":"295","inLanguage":"en","datePublished":"2023-07-04T00:00:00Z","dateModified":"2023-07-04T00:00:00Z","author":{"@type":"Person","name":"Yan Tang"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://kenanking.github.io/posts/2023/07-deeplabv2/"},"publisher":{"@type":"Organization","name":"Yan Tang","logo":{"@type":"ImageObject","url":"https://kenanking.github.io/assets/images/favicon-16x16.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://kenanking.github.io/ accesskey=h title="Yan Tang (Alt + H)">Yan Tang</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://kenanking.github.io/ title=Posts><span>Posts</span></a></li><li><a href=https://kenanking.github.io/about/ title=About><span>About</span></a></li><li><a href=https://kenanking.github.io/publications/ title=Publications><span>Publications</span></a></li><li><a href=https://kenanking.github.io/archives/ title=Archives><span>Archives</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class="post-title entry-hint-parent">DeepLabv2：基于空洞卷积与 ASPP 的语义图像分割</h1><div class=post-meta><span title='2023-07-04 00:00:00 +0000 UTC'>July 4, 2023</span>&nbsp;·&nbsp;<span>2 min</span>&nbsp;·&nbsp;<span>Yan Tang</span></div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#1-%e7%a9%ba%e6%b4%9e%e5%8d%b7%e7%a7%afatrousdilated-convolution aria-label="1. 空洞卷积（atrous/dilated convolution）">1. 空洞卷积（atrous/dilated convolution）</a><ul><li><a href=#%e5%ad%98%e5%9c%a8%e9%97%ae%e9%a2%98 aria-label=存在问题>存在问题</a></li></ul></li><li><a href=#2-atrous-spatial-pyramid-poolingaspp aria-label="2. Atrous Spatial Pyramid Pooling（ASPP）">2. Atrous Spatial Pyramid Pooling（ASPP）</a></li><li><a href=#3-fully-connected-crfs aria-label="3. Fully Connected CRFs">3. Fully Connected CRFs</a></li></ul></div></details></div><div class=post-content><p>DeepLabv2 通过空洞卷积和上采样滤波器进行密集特征提取，将在图像分类上训练的网络重新用于语义分割任务。文中进一步提出 ASPP 以在多个尺度上编码对象以及图像上下文。为了产生语义准确的预测和精细的物体边界分割图，文中还结合了深度卷积神经网络和全连接条件随机场的思想。</p><p>深度卷积神经网络应用于语义分割的三个挑战：</p><ul><li><strong>特征分辨率降低</strong>：DCNN 设计之初用于图像分类问题，使用多层的 Max-Pool 和全连接层，在处理图像时，特征空间分辨率降低。</li><li><strong>多尺度目标</strong>：图像中的分割对象以多种尺度存在。</li><li><strong>DCNN 的不变性导致的定位误差</strong>：深度卷积神经网络的不变性可能会导致定位精度降低。</li></ul><p>为了解决这些问题，DeepLabv2 使用了下面的方法：</p><ul><li>去除 Max-Pool 层并使用空洞卷积（atrous convolution）</li><li>空洞空间金字塔池化（atrous spatial pyramid pooling，ASPP）</li><li>深度卷积网络与概率图模型结合，使用全连接条件随机场（fully connected CRFs）进行后处理</li></ul><figure class=align-center><img loading=lazy src=images/DeepLabv2_model_illustration.png#center alt="DeepLabv2 模型示意图" width=650><figcaption><p>DeepLabv2 模型示意图</p></figcaption></figure><h2 id=1-空洞卷积atrousdilated-convolution>1. 空洞卷积（atrous/dilated convolution）<a hidden class=anchor aria-hidden=true href=#1-空洞卷积atrousdilated-convolution>#</a></h2><p>在一维情况下，空洞卷积定义为：</p><span class=katex-display><span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>y</mi><mo stretchy="false">[</mo><mi>i</mi><mo stretchy="false">]</mo><mo>=</mo><munderover><mo>∑</mo><mrow><mi>k</mi><mo>=</mo><mn>1</mn></mrow><mi>K</mi></munderover><mi>x</mi><mo stretchy="false">[</mo><mi>i</mi><mo>+</mo><mi>r</mi><mo>⋅</mo><mi>k</mi><mo stretchy="false">]</mo><mi>w</mi><mo stretchy="false">[</mo><mi>k</mi><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">
y[i]=\sum_{k=1}^K x[i+r \cdot k] w[k]
</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class="mord mathnormal" style=margin-right:.03588em>y</span><span class=mopen>[</span><span class="mord mathnormal">i</span><span class=mclose>]</span><span class=mspace style=margin-right:.2778em></span><span class=mrel>=</span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:3.1304em;vertical-align:-1.3021em></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:1.8283em><span style=top:-1.8479em;margin-left:0><span class=pstrut style=height:3.05em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style=margin-right:.03148em>k</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style=top:-3.05em><span class=pstrut style=height:3.05em></span><span><span class="mop op-symbol large-op">∑</span></span></span><span style=top:-4.3em;margin-left:0><span class=pstrut style=height:3.05em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style=margin-right:.07153em>K</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:1.3021em><span></span></span></span></span></span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal">x</span><span class=mopen>[</span><span class="mord mathnormal">i</span><span class=mspace style=margin-right:.2222em></span><span class=mbin>+</span><span class=mspace style=margin-right:.2222em></span></span><span class=base><span class=strut style=height:.4445em></span><span class="mord mathnormal" style=margin-right:.02778em>r</span><span class=mspace style=margin-right:.2222em></span><span class=mbin>⋅</span><span class=mspace style=margin-right:.2222em></span></span><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class="mord mathnormal" style=margin-right:.03148em>k</span><span class=mclose>]</span><span class="mord mathnormal" style=margin-right:.02691em>w</span><span class=mopen>[</span><span class="mord mathnormal" style=margin-right:.03148em>k</span><span class=mclose>]</span></span></span></span></span><p>其中：<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi><mo stretchy="false">[</mo><mi>i</mi><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">x[i]</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class="mord mathnormal">x</span><span class=mopen>[</span><span class="mord mathnormal">i</span><span class=mclose>]</span></span></span></span> 为输入信号，<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>y</mi><mo stretchy="false">[</mo><mi>i</mi><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">y[i]</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class="mord mathnormal" style=margin-right:.03588em>y</span><span class=mopen>[</span><span class="mord mathnormal">i</span><span class=mclose>]</span></span></span></span> 为输出信号，<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>w</mi><mo stretchy="false">[</mo><mi>k</mi><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">w[k]</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class="mord mathnormal" style=margin-right:.02691em>w</span><span class=mopen>[</span><span class="mord mathnormal" style=margin-right:.03148em>k</span><span class=mclose>]</span></span></span></span> 是一个长度为 <span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>K</mi></mrow><annotation encoding="application/x-tex">K</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6833em></span><span class="mord mathnormal" style=margin-right:.07153em>K</span></span></span></span> 的滤波器。<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>r</mi></mrow><annotation encoding="application/x-tex">r</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.4306em></span><span class="mord mathnormal" style=margin-right:.02778em>r</span></span></span></span> 是扩张率，当 <span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>r</mi><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">r=1</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.4306em></span><span class="mord mathnormal" style=margin-right:.02778em>r</span><span class=mspace style=margin-right:.2778em></span><span class=mrel>=</span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:.6444em></span><span class=mord>1</span></span></span></span> 时退化为标准卷积。</p><p>在语义分割模型中，通过在卷积核的每个像素之间插入“空洞”（零）来构建二维的空洞卷积。</p><figure class="multi-figure align-center"><div class=multi-figure-container><div class=multi-figure-row data-images=3><figure class=multi-figure-item><img loading=lazy decoding=async src=images/dilation.gif alt=空洞卷积><figcaption>空洞卷积</figcaption></figure><figure class=multi-figure-item><img loading=lazy decoding=async src=images/dilation_2.gif alt=扩张率为3的空洞卷积><figcaption>扩张率为3的空洞卷积</figcaption></figure><figure class=multi-figure-item><img loading=lazy decoding=async src=images/convolution.gif alt=普通卷积><figcaption>普通卷积</figcaption></figure></div></div><figcaption><p>空洞卷积、扩张率为3的空洞卷积和普通卷积的对比</p></figcaption></figure><ul><li><p>空洞卷积在不增加参数量和计算量的情况下，有效地增加了滤波器的 <strong>感受野（field-of-view）</strong>。对于语义分割（或目标检测）来说，增加感受野可以更好地捕捉图像的 <strong>上下文信息（context）</strong>，从而提升多尺度目标的提取能力。</p></li><li><p>另外，在 DCNN 中通过 Max-Pool（或带 stride 的卷积）的方式提升感受野，这种方式会降低特征图的分辨率，导致空间信息的丢失。<strong>空洞卷积允许网络在不降低分辨率的情况下增加感受野</strong>，这在图像分割中非常重要。</p></li></ul><p>从下图可以看到引入空洞卷积后，对 VGG16 网络的感受野的影响（DeepLab_LargeFOV）：</p><figure class=align-center><img loading=lazy src=images/receptive_field_growth.png#center alt="VGG16 网络各层感受野增长对比图" width=600><figcaption><p>VGG16 网络各层感受野增长对比图：蓝色圆点表示原始模型，橙色方框表示 DeepLab-LargeFOV 模型</p></figcaption></figure><h3 id=存在问题>存在问题<a hidden class=anchor aria-hidden=true href=#存在问题>#</a></h3><ul><li><p>理论上，空洞卷积天生存在 <strong>格网效应（Gridding Effect）</strong>。在下图中，连续三次使用扩张率为 <span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>2</mn></mrow><annotation encoding="application/x-tex">2</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6444em></span><span class=mord>2</span></span></span></span>（<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>r</mi><mo>=</mo><mn>2</mn></mrow><annotation encoding="application/x-tex">r=2</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.4306em></span><span class="mord mathnormal" style=margin-right:.02778em>r</span><span class=mspace style=margin-right:.2778em></span><span class=mrel>=</span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:.6444em></span><span class=mord>2</span></span></span></span>）的空洞卷积时，对于中心像素 <span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi></mrow><annotation encoding="application/x-tex">p</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.625em;vertical-align:-.1944em></span><span class="mord mathnormal">p</span></span></span></span> 只能以棋盘的方式获取上下文信息，丢失了 <span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>75</mn><mi mathvariant="normal">%</mi></mrow><annotation encoding="application/x-tex">75\%</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.8056em;vertical-align:-.0556em></span><span class=mord>75%</span></span></span></span> 的有效信息 <sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup>。在参数选择上，过小的扩张率会获取不到足够的上下文信息，而过大的扩张率会导致更严重的格网效应。</p><figure><img loading=lazy src=images/Grid_effect_of_dilated_convolution.png alt=空洞卷积的格网效应><figcaption><p>空洞卷积的格网效应</p></figcaption></figure><p>因此提出了 <strong>混合空洞卷积（hybrid dilated convolution，HDC）</strong> 的方式，连续三个空洞卷积的扩张率分别设置为 <span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>r</mi><mo>=</mo><mo stretchy="false">[</mo><mn>1</mn><mo separator="true">,</mo><mn>2</mn><mo separator="true">,</mo><mn>5</mn><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">r=[1,2,5]</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.4306em></span><span class="mord mathnormal" style=margin-right:.02778em>r</span><span class=mspace style=margin-right:.2778em></span><span class=mrel>=</span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mopen>[</span><span class=mord>1</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class=mord>2</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class=mord>5</span><span class=mclose>]</span></span></span></span> 来避免格网效应。</p><figure><img loading=lazy src=images/hydrid_dilated_convolution.png alt=混合空洞卷积（HDC）><figcaption><p>混合空洞卷积（HDC）</p></figcaption></figure></li><li><p>当输入特征图具有高频内容时，空洞卷积可能在输出中产生格网效应，如下图中的第三列 <sup id=fnref:2><a href=#fn:2 class=footnote-ref role=doc-noteref>2</a></sup>。我的理解：空洞卷积会把距离较远的高频激活值带到当前的位置（同样也有可能把低频信息带到当前位置），其实可能会导致当前位置的信息与局部的特征不匹配。<strong>（高频值对参数影响大，高频的激活值会不利于网络训练）</strong></p><figure class=align-center><img loading=lazy src=images/Grid_effect_of_high_frequency_activation.png#center alt=高频信息在格网效应后的输出 width=550><figcaption><p>高频信息在格网效应后的输出</p></figcaption></figure><ul><li><strong>去除 Max-Pool</strong>：Max-Pool 容易引入高频的激活值，使用卷积替换 Max-Pool 可以缓解网格化。（有效性难说！）</li><li><strong>在网络最后添加扩张率逐渐减小的卷积层</strong>：类似 HDC。</li><li><strong>在后面添加的卷积层中去除残差连接</strong>：防止之前层的高频信号往后传播。</li></ul><figure><img loading=lazy src=images/Resnet18_activation_maps.png alt=空洞卷积导致的格网效应><figcaption><p>空洞卷积导致的格网效应</p></figcaption></figure></li></ul><h2 id=2-atrous-spatial-pyramid-poolingaspp>2. Atrous Spatial Pyramid Pooling（ASPP）<a hidden class=anchor aria-hidden=true href=#2-atrous-spatial-pyramid-poolingaspp>#</a></h2><p>文中尝试了两种不同的方式来处理多尺度问题：</p><ul><li><p>将 <strong>原始图像缩放为三个不同的尺寸</strong>，输入到权重共享的DCNN中得到特征图，将特征图使用双线性插值到原图分辨率，通过选取每个尺度下最大的响应值来进行特征融合。</p></li><li><p>受 SPP <sup id=fnref:3><a href=#fn:3 class=footnote-ref role=doc-noteref>3</a></sup> 启发，<strong>对单一尺度提取的卷积特征进行重新采样获取多尺度特征</strong>。文中使用空洞卷积实现了SPP的变体ASPP，通过不同的采样率，ASPP能够探测具有不同感受野的特征，从而在多个尺度上捕获分割对象以及图像的上下文信息。</p><figure class=align-center><img loading=lazy src=images/Spatial_Pyramid_Pooling.png#center alt="Spatial Pyramid Pooling" width=600><figcaption><p>Spatial Pyramid Pooling</p></figcaption></figure><p>SPP 将图像分成多个子区域，在每个区域内进行池化操作，最后将所有区域的池化结果拼接成一个固定长度 <span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mn>16</mn><mo>+</mo><mn>4</mn><mo>+</mo><mn>1</mn><mo stretchy="false">)</mo><mo>×</mo><mn>256</mn></mrow><annotation encoding="application/x-tex">(16+4+1) \times 256</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mopen>(</span><span class=mord>16</span><span class=mspace style=margin-right:.2222em></span><span class=mbin>+</span><span class=mspace style=margin-right:.2222em></span></span><span class=base><span class=strut style=height:.7278em;vertical-align:-.0833em></span><span class=mord>4</span><span class=mspace style=margin-right:.2222em></span><span class=mbin>+</span><span class=mspace style=margin-right:.2222em></span></span><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mord>1</span><span class=mclose>)</span><span class=mspace style=margin-right:.2222em></span><span class=mbin>×</span><span class=mspace style=margin-right:.2222em></span></span><span class=base><span class=strut style=height:.6444em></span><span class=mord>256</span></span></span></span> 的向量。</p><figure class=align-center><img loading=lazy src=images/Atrous_Spatial_Pyramid_Pooling.png#center alt="Atrous Spatial Pyramid Pooling" width=600><figcaption><p>Atrous Spatial Pyramid Pooling</p></figcaption></figure><p>下面是在加入了 ASPP 后相比原 DeepLabv1 的改进。</p><figure class=align-center><img loading=lazy src=images/DeepLab_ASPP.png#center alt=DeepLab-ASPP width=600><figcaption><p>DeepLab-ASPP</p></figcaption></figure></li></ul><h2 id=3-fully-connected-crfs>3. Fully Connected CRFs<a hidden class=anchor aria-hidden=true href=#3-fully-connected-crfs>#</a></h2><p>条件随机场（CRFs）是一种概率图模型，它可以用来 <strong>建模输出变量之间的依赖关系</strong>，被用于语义分割和单目深度估计任务（NeW CRFs <sup id=fnref:4><a href=#fn:4 class=footnote-ref role=doc-noteref>4</a></sup>，CVPR 2022）中。可以证明，CRFs 在基于当前和相邻节点信息的情况下，能有效纠正错误的预测结果。<strong>CRFs 倾向于将空间上和颜色上相近的点归于相同的类别标签</strong>，起到平滑预测结果、去除噪声的作用。</p><p>在语义图像分割中，输出变量就是每个像素的类别标签，而依赖关系就是像素之间的相似性和一致性。CRFs 可以用来对DCNNs的预测结果进行优化，使得分割结果更加平滑和精确。</p><p>在图模型中，全连接的 CRFs 的能量函数定义为：</p><span class=katex-display><span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>E</mi><mo stretchy="false">(</mo><mi mathvariant="bold-italic">x</mi><mo stretchy="false">)</mo><mo>=</mo><munder><mo>∑</mo><mi>i</mi></munder><msub><mi>θ</mi><mi>i</mi></msub><mrow><mo fence="true">(</mo><msub><mi>x</mi><mi>i</mi></msub><mo fence="true">)</mo></mrow><mo>+</mo><munder><mo>∑</mo><mrow><mi>i</mi><mi>j</mi></mrow></munder><msub><mi>θ</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mrow><mo fence="true">(</mo><msub><mi>x</mi><mi>i</mi></msub><mo separator="true">,</mo><msub><mi>x</mi><mi>j</mi></msub><mo fence="true">)</mo></mrow></mrow><annotation encoding="application/x-tex">
E(\boldsymbol{x})=\sum_i \theta_i\left(x_i\right)+\sum_{i j} \theta_{i j}\left(x_i, x_j\right)
</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class="mord mathnormal" style=margin-right:.05764em>E</span><span class=mopen>(</span><span class=mord><span class=mord><span class="mord boldsymbol">x</span></span></span><span class=mclose>)</span><span class=mspace style=margin-right:.2778em></span><span class=mrel>=</span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:2.3277em;vertical-align:-1.2777em></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:1.05em><span style=top:-1.8723em;margin-left:0><span class=pstrut style=height:3.05em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span><span style=top:-3.05em><span class=pstrut style=height:3.05em></span><span><span class="mop op-symbol large-op">∑</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:1.2777em><span></span></span></span></span></span><span class=mspace style=margin-right:.1667em></span><span class=mord><span class="mord mathnormal" style=margin-right:.02778em>θ</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:-.0278em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mspace style=margin-right:.1667em></span><span class=minner><span class="mopen delimcenter" style=top:0>(</span><span class=mord><span class="mord mathnormal">x</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class="mclose delimcenter" style=top:0>)</span></span><span class=mspace style=margin-right:.2222em></span><span class=mbin>+</span><span class=mspace style=margin-right:.2222em></span></span><span class=base><span class=strut style=height:2.4638em;vertical-align:-1.4138em></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:1.05em><span style=top:-1.8723em;margin-left:0><span class=pstrut style=height:3.05em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style=margin-right:.05724em>ij</span></span></span></span><span style=top:-3.05em><span class=pstrut style=height:3.05em></span><span><span class="mop op-symbol large-op">∑</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:1.4138em><span></span></span></span></span></span><span class=mspace style=margin-right:.1667em></span><span class=mord><span class="mord mathnormal" style=margin-right:.02778em>θ</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:-.0278em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style=margin-right:.05724em>ij</span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.2861em><span></span></span></span></span></span></span><span class=mspace style=margin-right:.1667em></span><span class=minner><span class="mopen delimcenter" style=top:0>(</span><span class=mord><span class="mord mathnormal">x</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class=mord><span class="mord mathnormal">x</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style=margin-right:.05724em>j</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.2861em><span></span></span></span></span></span></span><span class="mclose delimcenter" style=top:0>)</span></span></span></span></span></span><p>其中，<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="bold-italic">x</mi></mrow><annotation encoding="application/x-tex">\boldsymbol{x}</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.4444em></span><span class=mord><span class=mord><span class="mord boldsymbol">x</span></span></span></span></span></span> 为类别标签，<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>θ</mi><mi>i</mi></msub><mo>=</mo><mo>−</mo><mi>log</mi><mo>⁡</mo><mi>P</mi><mo stretchy="false">(</mo><msub><mi>x</mi><mi>i</mi></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\theta_i=-\log P(x_i)</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.8444em;vertical-align:-.15em></span><span class=mord><span class="mord mathnormal" style=margin-right:.02778em>θ</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:-.0278em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mspace style=margin-right:.2778em></span><span class=mrel>=</span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mord>−</span><span class=mspace style=margin-right:.1667em></span><span class=mop>lo<span style=margin-right:.01389em>g</span></span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.13889em>P</span><span class=mopen>(</span><span class=mord><span class="mord mathnormal">x</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mclose>)</span></span></span></span> 为一元势函数（unary potential），<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mo stretchy="false">(</mo><msub><mi>x</mi><mi>i</mi></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">P(x_i)</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class="mord mathnormal" style=margin-right:.13889em>P</span><span class=mopen>(</span><span class=mord><span class="mord mathnormal">x</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mclose>)</span></span></span></span> 是 DCNN 预测的当前类别标签的置信度。<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>θ</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub></mrow><annotation encoding="application/x-tex">\theta_{i j}</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.9805em;vertical-align:-.2861em></span><span class=mord><span class="mord mathnormal" style=margin-right:.02778em>θ</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:-.0278em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style=margin-right:.05724em>ij</span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.2861em><span></span></span></span></span></span></span></span></span></span> 为二元势函数（pairwise potential），表示对于所有的像素对 <span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6595em></span><span class="mord mathnormal">i</span></span></span></span>、<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>j</mi></mrow><annotation encoding="application/x-tex">j</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.854em;vertical-align:-.1944em></span><span class="mord mathnormal" style=margin-right:.05724em>j</span></span></span></span>，当它们的位置 <span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi></mrow><annotation encoding="application/x-tex">p</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.625em;vertical-align:-.1944em></span><span class="mord mathnormal">p</span></span></span></span> 和像素值 <span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>I</mi></mrow><annotation encoding="application/x-tex">I</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6833em></span><span class="mord mathnormal" style=margin-right:.07847em>I</span></span></span></span> 越接近时，越倾向于归为同一类。二元势函数的形式如下：</p><span class=katex-display><span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable rowspacing="0.25em" columnalign="center" columnspacing="0em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><msub><mi>θ</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mrow><mo fence="true">(</mo><msub><mi>x</mi><mi>i</mi></msub><mo separator="true">,</mo><msub><mi>x</mi><mi>j</mi></msub><mo fence="true">)</mo></mrow><mo>=</mo><mi>μ</mi><mrow><mo fence="true">(</mo><msub><mi>x</mi><mi>i</mi></msub><mo separator="true">,</mo><msub><mi>x</mi><mi>j</mi></msub><mo fence="true">)</mo></mrow><mrow><mo fence="true">[</mo><msub><mi>w</mi><mn>1</mn></msub><mi>exp</mi><mo>⁡</mo><mrow><mo fence="true">(</mo><mo>−</mo><mfrac><msup><mrow><mo fence="true">∥</mo><msub><mi>p</mi><mi>i</mi></msub><mo>−</mo><msub><mi>p</mi><mi>j</mi></msub><mo fence="true">∥</mo></mrow><mn>2</mn></msup><mrow><mn>2</mn><msubsup><mi>σ</mi><mi>α</mi><mn>2</mn></msubsup></mrow></mfrac><mo>−</mo><mfrac><msup><mrow><mo fence="true">∥</mo><msub><mi>I</mi><mi>i</mi></msub><mo>−</mo><msub><mi>I</mi><mi>j</mi></msub><mo fence="true">∥</mo></mrow><mn>2</mn></msup><mrow><mn>2</mn><msubsup><mi>σ</mi><mi>β</mi><mn>2</mn></msubsup></mrow></mfrac><mo fence="true">)</mo></mrow></mrow></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mo>+</mo><msub><mi>w</mi><mn>2</mn></msub><mi>exp</mi><mo>⁡</mo><mrow><mo fence="true">(</mo><mo>−</mo><mfrac><msup><mrow><mo fence="true">∥</mo><msub><mi>p</mi><mi>i</mi></msub><mo>−</mo><msub><mi>p</mi><mi>j</mi></msub><mo fence="true">∥</mo></mrow><mn>2</mn></msup><mrow><mn>2</mn><msubsup><mi>σ</mi><mi>γ</mi><mn>2</mn></msubsup></mrow></mfrac><mo fence="true">)</mo></mrow><mo fence="true">]</mo></mrow></mstyle></mtd></mtr></mtable><annotation encoding="application/x-tex">
\begin{gathered}
\theta_{i j}\left(x_i, x_j\right)=\mu\left(x_i, x_j\right)\left[w_1 \exp \left(-\frac{\left\|p_i-p_j\right\|^2}{2 \sigma_\alpha^2}-\frac{\left\|I_i-I_j\right\|^2}{2 \sigma_\beta^2}\right)\right. \\
\left.+w_2 \exp \left(-\frac{\left\|p_i-p_j\right\|^2}{2 \sigma_\gamma^2}\right)\right]
\end{gathered}
</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:6.6001em;vertical-align:-3.05em></span><span class=mord><span class=mtable><span class=col-align-c><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:3.55em><span style=top:-5.55em><span class=pstrut style=height:3.75em></span><span class=mord><span class=mord><span class="mord mathnormal" style=margin-right:.02778em>θ</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:-.0278em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style=margin-right:.05724em>ij</span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.2861em><span></span></span></span></span></span></span><span class=mspace style=margin-right:.1667em></span><span class=minner><span class="mopen delimcenter" style=top:0>(</span><span class=mord><span class="mord mathnormal">x</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class=mord><span class="mord mathnormal">x</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style=margin-right:.05724em>j</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.2861em><span></span></span></span></span></span></span><span class="mclose delimcenter" style=top:0>)</span></span><span class=mspace style=margin-right:.2778em></span><span class=mrel>=</span><span class=mspace style=margin-right:.2778em></span><span class="mord mathnormal">μ</span><span class=mspace style=margin-right:.1667em></span><span class=minner><span class="mopen delimcenter" style=top:0>(</span><span class=mord><span class="mord mathnormal">x</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class=mord><span class="mord mathnormal">x</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style=margin-right:.05724em>j</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.2861em><span></span></span></span></span></span></span><span class="mclose delimcenter" style=top:0>)</span></span><span class=mspace style=margin-right:.1667em></span><span class=minner><span class="mopen delimcenter" style=top:0><span class="delimsizing size4">[</span></span><span class=mord><span class="mord mathnormal" style=margin-right:.02691em>w</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3011em><span style=top:-2.55em;margin-left:-.0269em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mspace style=margin-right:.1667em></span><span class=mop>exp</span><span class=mspace style=margin-right:.1667em></span><span class=minner><span class="mopen delimcenter" style=top:0><span class="delimsizing size4">(</span></span><span class=mord>−</span><span class=mord><span class="mopen nulldelimiter"></span><span class=mfrac><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:1.631em><span style=top:-2.314em><span class=pstrut style=height:3em></span><span class=mord><span class=mord>2</span><span class=mord><span class="mord mathnormal" style=margin-right:.03588em>σ</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.7401em><span style=top:-2.453em;margin-left:-.0359em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style=margin-right:.0037em>α</span></span></span><span style=top:-2.989em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.247em><span></span></span></span></span></span></span></span></span><span style=top:-3.23em><span class=pstrut style=height:3em></span><span class=frac-line style=border-bottom-width:.04em></span></span><span style=top:-3.677em><span class=pstrut style=height:3em></span><span class=mord><span class=minner><span class=minner><span class="mopen delimcenter" style=top:0>∥</span><span class=mord><span class="mord mathnormal">p</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mspace style=margin-right:.2222em></span><span class=mbin>−</span><span class=mspace style=margin-right:.2222em></span><span class=mord><span class="mord mathnormal">p</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style=margin-right:.05724em>j</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.2861em><span></span></span></span></span></span></span><span class="mclose delimcenter" style=top:0>∥</span></span><span class=msupsub><span class=vlist-t><span class=vlist-r><span class=vlist style=height:.954em><span style=top:-3.2029em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.933em><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class=mspace style=margin-right:.2222em></span><span class=mbin>−</span><span class=mspace style=margin-right:.2222em></span><span class=mord><span class="mopen nulldelimiter"></span><span class=mfrac><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:1.631em><span style=top:-2.314em><span class=pstrut style=height:3em></span><span class=mord><span class=mord>2</span><span class=mord><span class="mord mathnormal" style=margin-right:.03588em>σ</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.7959em><span style=top:-2.3987em;margin-left:-.0359em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style=margin-right:.05278em>β</span></span></span><span style=top:-3.0448em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.4374em><span></span></span></span></span></span></span></span></span><span style=top:-3.23em><span class=pstrut style=height:3em></span><span class=frac-line style=border-bottom-width:.04em></span></span><span style=top:-3.677em><span class=pstrut style=height:3em></span><span class=mord><span class=minner><span class=minner><span class="mopen delimcenter" style=top:0>∥</span><span class=mord><span class="mord mathnormal" style=margin-right:.07847em>I</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:-.0785em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mspace style=margin-right:.2222em></span><span class=mbin>−</span><span class=mspace style=margin-right:.2222em></span><span class=mord><span class="mord mathnormal" style=margin-right:.07847em>I</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:-.0785em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style=margin-right:.05724em>j</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.2861em><span></span></span></span></span></span></span><span class="mclose delimcenter" style=top:0>∥</span></span><span class=msupsub><span class=vlist-t><span class=vlist-r><span class=vlist style=height:.954em><span style=top:-3.2029em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:1.1234em><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mclose delimcenter" style=top:0><span class="delimsizing size4">)</span></span></span><span class="mclose nulldelimiter"></span></span></span></span><span style=top:-2.25em><span class=pstrut style=height:3.75em></span><span class=mord><span class=minner><span class="mopen nulldelimiter"></span><span class=mord>+</span><span class=mord><span class="mord mathnormal" style=margin-right:.02691em>w</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3011em><span style=top:-2.55em;margin-left:-.0269em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mspace style=margin-right:.1667em></span><span class=mop>exp</span><span class=mspace style=margin-right:.1667em></span><span class=minner><span class="mopen delimcenter" style=top:0><span class="delimsizing size4">(</span></span><span class=mord>−</span><span class=mord><span class="mopen nulldelimiter"></span><span class=mfrac><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:1.631em><span style=top:-2.314em><span class=pstrut style=height:3em></span><span class=mord><span class=mord>2</span><span class=mord><span class="mord mathnormal" style=margin-right:.03588em>σ</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.7401em><span style=top:-2.453em;margin-left:-.0359em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style=margin-right:.05556em>γ</span></span></span><span style=top:-2.989em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.3831em><span></span></span></span></span></span></span></span></span><span style=top:-3.23em><span class=pstrut style=height:3em></span><span class=frac-line style=border-bottom-width:.04em></span></span><span style=top:-3.677em><span class=pstrut style=height:3em></span><span class=mord><span class=minner><span class=minner><span class="mopen delimcenter" style=top:0>∥</span><span class=mord><span class="mord mathnormal">p</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mspace style=margin-right:.2222em></span><span class=mbin>−</span><span class=mspace style=margin-right:.2222em></span><span class=mord><span class="mord mathnormal">p</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style=margin-right:.05724em>j</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.2861em><span></span></span></span></span></span></span><span class="mclose delimcenter" style=top:0>∥</span></span><span class=msupsub><span class=vlist-t><span class=vlist-r><span class=vlist style=height:.954em><span style=top:-3.2029em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:1.0691em><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mclose delimcenter" style=top:0><span class="delimsizing size4">)</span></span></span><span class="mclose delimcenter" style=top:0><span class="delimsizing size4">]</span></span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:3.05em><span></span></span></span></span></span></span></span></span></span></span></span><p>其中，当 <span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>x</mi><mi>i</mi></msub><mo mathvariant="normal">≠</mo><msub><mi>x</mi><mi>j</mi></msub></mrow><annotation encoding="application/x-tex">x_i \neq x_j</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.8889em;vertical-align:-.1944em></span><span class=mord><span class="mord mathnormal">x</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mspace style=margin-right:.2778em></span><span class=mrel><span class=mrel><span class="mord vbox"><span class=thinbox><span class=rlap><span class=strut style=height:.8889em;vertical-align:-.1944em></span><span class=inner><span class=mord><span class=mrel></span></span></span><span class=fix></span></span></span></span></span><span class=mrel>=</span></span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:.7167em;vertical-align:-.2861em></span><span class=mord><span class="mord mathnormal">x</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style=margin-right:.05724em>j</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.2861em><span></span></span></span></span></span></span></span></span></span> 时，<span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>μ</mi><mrow><mo fence="true">(</mo><msub><mi>x</mi><mi>i</mi></msub><mo separator="true">,</mo><msub><mi>x</mi><mi>j</mi></msub><mo fence="true">)</mo></mrow><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">\mu\left(x_i, x_j\right)=1</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1.0361em;vertical-align:-.2861em></span><span class="mord mathnormal">μ</span><span class=mspace style=margin-right:.1667em></span><span class=minner><span class="mopen delimcenter" style=top:0>(</span><span class=mord><span class="mord mathnormal">x</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class=mord><span class="mord mathnormal">x</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style=margin-right:.05724em>j</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.2861em><span></span></span></span></span></span></span><span class="mclose delimcenter" style=top:0>)</span></span><span class=mspace style=margin-right:.2778em></span><span class=mrel>=</span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:.6444em></span><span class=mord>1</span></span></span></span>，否则为 <span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0</mn></mrow><annotation encoding="application/x-tex">0</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6444em></span><span class=mord>0</span></span></span></span>。</p><p><strong>一元势函数中的信息由神经网络输出的概率图提供</strong>，<strong>二元势函数中的信息由原图提供</strong>。当能量函数 <span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>E</mi><mo stretchy="false">(</mo><mi mathvariant="bold-italic">x</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">E(\boldsymbol{x})</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class="mord mathnormal" style=margin-right:.05764em>E</span><span class=mopen>(</span><span class=mord><span class=mord><span class="mord boldsymbol">x</span></span></span><span class=mclose>)</span></span></span></span> 越小时，预测的类别标签 <span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="bold-italic">x</mi></mrow><annotation encoding="application/x-tex">\boldsymbol{x}</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.4444em></span><span class=mord><span class=mord><span class="mord boldsymbol">x</span></span></span></span></span></span> 就越准确，通过迭代最小化能量函数，得到最终的后处理结果。该能量函数可以通过 <strong>近似推断</strong> 的方式进一步加速 <sup id=fnref:5><a href=#fn:5 class=footnote-ref role=doc-noteref>5</a></sup>。</p><p>在下图中可以看到，使用 CRFs 后，在对象的边界处可以得到更明确的分类效果。至于为什么要在全图范围计算 CRFs，文中提到是因为 DCNN 给出的结果非常平滑（下图第一行第二列），使用 <strong>短程（short-range）的 CRF 会进一步平滑结果</strong>。</p><figure><img loading=lazy src=images/CRF_Results.png alt="CRF 对分割结果的精化"><figcaption><p>CRF 对分割结果的精化</p></figcaption></figure><p>全连接的 CRFs 针对全图计算能量函数，当图像分辨率提升时，计算量会急剧增加。因此，在 NeW CRFs（CVPR 2022）工作中，划分了多个窗口计算 CRFs，并引入了 Swin Transformer 中的滑窗方式，在不同窗口中进行交互。</p><figure class=align-center><img loading=lazy src=images/fully_connected_CRFs_and_window_fully_connected_CRFs.png#center alt="全连接的 CRFs 和分窗口的 CRFs" width=550><figcaption><p>全连接的 CRFs 和分窗口的 CRFs</p></figcaption></figure><div class=footnotes role=doc-endnotes><hr><ol><li id=fn:1><p>Wang, P., <em>et al.</em> “Understanding Convolution for Semantic Segmentation.” <strong>IEEE WACV</strong>, 2018.&#160;<a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:2><p>Yu, F., Koltun, V., Funkhouser, T. “Dilated Residual Networks.” <strong>CVPR</strong>, 2017.&#160;<a href=#fnref:2 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:3><p>He, K., <em>et al.</em> “Spatial Pyramid Pooling in Deep Convolutional Networks for Visual Recognition.” <strong>IEEE TPAMI</strong> 37(9), 2015.&#160;<a href=#fnref:3 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:4><p>Yuan, W., <em>et al.</em> “Neural Window Fully-Connected CRFs for Monocular Depth Estimation.” <strong>CVPR</strong>, 2022.&#160;<a href=#fnref:4 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:5><p>Krähenbühl, P., Koltun, V. “Efficient Inference in Fully Connected CRFs with Gaussian Edge Potentials.” <strong>NIPS</strong>, 2011.&#160;<a href=#fnref:5 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></div></div><footer class=post-footer><ul class=post-tags><li><a href=https://kenanking.github.io/tags/%E5%9B%BE%E5%83%8F%E5%88%86%E5%89%B2/>图像分割</a></li><li><a href=https://kenanking.github.io/tags/deeplabv1/>DeepLabv1</a></li><li><a href=https://kenanking.github.io/tags/deeplabv2/>DeepLabv2</a></li></ul><nav class=paginav><a class=prev href=https://kenanking.github.io/posts/2023/01-vit/><span class=title>« Prev</span><br><span>Vision Transformer —— 图像识别中的 Transformer 架构</span>
</a><a class=next href=https://kenanking.github.io/posts/2022/01-einsums/><span class=title>Next »</span><br><span>机器学习中的爱因斯坦求和（Einsums）</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2025 <a href=https://kenanking.github.io/>Yan Tang</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>(function(){function e(){var e,t,n,s=document.getElementsByTagName("code");for(n=0;n<s.length;){if(t=s[n],t.parentNode.tagName!=="PRE"&&t.childElementCount===0&&(e=t.textContent,/^\$[^$]/.test(e)&&/[^$]\$$/.test(e)&&(e=e.replace(/^\$/,"\\(").replace(/\$$/,"\\)"),t.textContent=e),/^\\\((.|\s)+\\\)$/.test(e)||/^\\\[(.|\s)+\\\]$/.test(e)||/^\$(.|\s)+\$$/.test(e)||/^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(e))){t.outerHTML=t.innerHTML;continue}n++}}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",e,{once:!0}):e()})()</script><script>(function(){var n=window.pageYOffset||document.documentElement.scrollTop||0,s=800,t=!1,e=null;function o(){if(t=!1,e||(e=document.getElementById("top-link")),!e)return;var o=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0,i=o>n;n=o<0?0:o,o>s&&!i?(e.style.visibility="visible",e.style.opacity="1"):(e.style.visibility="hidden",e.style.opacity="0")}window.addEventListener("scroll",function(){t||(window.requestAnimationFrame(o),t=!0)},{passive:!0})})()</script><script>(function(){var t=10;function n(e){if(!e)return[0,20];var n,s,o=window.getComputedStyle(e),t=parseFloat(o.lineHeight);return(!t||isNaN(t))&&(t=20),n=e.getBoundingClientRect(),s=n.height||e.offsetHeight||0,[Math.round(s/t),t]}function e(){var e=document.querySelectorAll(".highlight");if(!e||!e.length)return;Array.prototype.forEach.call(e,function(e){if(e.classList.contains("expanded")||e.classList.contains("collapsible"))return;var s,o,a,r,c,l,i=e.querySelector("pre code");if(!i)return;if(r=i.className||"",r.indexOf("language-mermaid")>=0||e.classList.contains("mermaid"))return;if(a=n(i),c=a[0],l=a[1],c<=t)return;e.classList.add("collapsible"),e.style.setProperty("--code-line-height",l+"px"),e.id||(e.id="code-block-"+Math.random().toString(36).slice(2)),o=document.createElement("div"),o.className="code-expand-wrapper",s=document.createElement("button"),s.type="button",s.className="code-expand-link",s.textContent="Show more",s.setAttribute("aria-expanded","false"),s.setAttribute("aria-controls",e.id),s.addEventListener("click",function(){var n,i,a,o=e.classList.contains("expanded"),r=getComputedStyle(e).getPropertyValue("--code-line-height"),t=parseFloat(r)*(parseFloat(getComputedStyle(e).getPropertyValue("--code-max-lines"))||10);(!isFinite(t)||t<=0)&&(t=10*20),i=e.getBoundingClientRect().height,a=o?t:e.scrollHeight,e.style.maxHeight=i+"px",e.offsetHeight,o?e.classList.remove("expanded"):e.classList.add("expanded"),e.style.maxHeight=a+"px",n=function(t){if(t.propertyName!=="max-height")return;if(e.removeEventListener("transitionend",n),e.style.maxHeight="",e.classList.contains("expanded"))s.textContent="Show less",s.setAttribute("aria-expanded","true");else{s.textContent="Show more",s.setAttribute("aria-expanded","false");try{e.scrollIntoView({behavior:"smooth",block:"nearest"})}catch{}}window.dispatchEvent(new Event("resize"))},e.addEventListener("transitionend",n)}),o.appendChild(s),e.nextSibling?e.parentNode.insertBefore(o,e.nextSibling):e.parentNode.appendChild(o)})}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",e,{once:!0}):e()})()</script><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>